<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="css/basic.css" />
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="css/shop_show.css" />
</head>
<body>
    <div class="wrap">
        <div class="shop_head_nav">
            <div class="wrap_1200">
                <ul>
                    <li class="login fl">登录</li>
                    <li class="register fl">注册</li>
                    <li class="fr"><a href="">帮助</a></li>
                    <li class="fr"><a href="">商品展示</a></li>
                    <li class="fr"><a href="">购物车</a></li>
                    <li class="fr"><a href="">个人中心</a></li>
                    <li class="fr"><a href="">首页</a></li>
                </ul>
            </div>
        </div>
        <div class="wrap_1200">
            <p class="navs"><a href="">首页></a><a href="">商品展示></a><a href="">详情页</a></p>
        </div>
        <div class="shop_show wrap_1200">
            <div class="shop_show_head">
                <ul class="clearfix">
                    <li class="fl x1">全选<input type="checkbox" class="allcheck" /></li>
                    <li class="fl x7">商品名称</li>
                    <li class="fl x1">单价</li>
                    <li class="fl x1">数量</li>
                    <li class="fl x1">金额</li>
                    <li class="fl x1">操作</li> 
                </ul>
            </div>
            <div class="shop_show_content">
                <ul class="clearfix">
                   <li class="fl x1"><input type="checkbox"  class="itemcheck" /></li>
                    <li  class="fl x7 goods">
                    <img src="http://img4.youxiake.com/9445.515524700395.jpg" alt="" />
                    <p>游小侠钥匙扣黄色/9.5cm*3cm</p>
                    </li>
                    <li class="fl x1">
                        <span class="price">20元</span>
                    </li>
                    <li class="fl x1">
                        <p><em class="reduce">-</em><input type="text" class="count" value="2"/><em class="add">+</em></p>
                    </li>
                    <li class="fl x1">
                        <span class="item_price">40元</span>
                    </li>
                    <li class="fl x1">
                        <em class="close">X</em>
                    </li> 
                </ul>
            </div>
            <div class="shop_show_content">
                <ul class="clearfix">
                   <li class="fl x1"><input type="checkbox"  class="itemcheck" /></li>
                    <li  class="fl x7 goods">
                    <img src="http://img4.youxiake.com/9445.515524700395.jpg" alt="" />
                    <p>游小侠钥匙扣黄色/9.5cm*3cm</p>
                    </li>
                    <li class="fl x1">
                        <span class="price">20元</span>
                    </li>
                    <li class="fl x1">
                        <p><em class="reduce">-</em><input type="text" class="count" value="2"/><em class="add">+</em></p>
                    </li>
                    <li class="fl x1">
                        <span class="item_price">40元</span>
                    </li>
                    <li class="fl x1">
                        <em class="close">X</em>
                    </li> 
                </ul>
            </div>
            <div class="shop_show_content" data-id="1">
                <ul class="clearfix">
                   <li class="fl x1"><input type="checkbox" class="itemcheck" /></li>
                    <li  class="fl x7 goods">
                    <img src="http://img4.youxiake.com/9445.515524700395.jpg" alt="" />
                    <p>游小侠钥匙扣黄色/9.5cm*3cm</p>
                    </li>
                    <li class="fl x1">
                        <span class="price">20元</span>
                    </li>
                    <li class="fl x1">
                        <p><em class="reduce">-</em><input type="text" class="count" value="2"/><em class="add">+</em></p>
                    </li>
                    <li class="fl x1">
                        <span  class="item_price">40元</span>
                    </li>
                    <li class="fl x1">
                        <em class="close">X</em>
                    </li> 
                </ul>
            </div>
            <div class="shop_show_foot clearfix">
                <span class="fl">全选<input type="checkbox" class="allcheck" /></span>
                <span class="remove">删除选中商品</span>
                <span class="qing">清空失效商品</span>
                <span>总价<em class="all_price">10</em></span>
                <button class="fr nos no_buy">立即购买</button>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript">
    $(function(){
        var is_true=0;
        var goods_count=20;//库存
        itemPrice();
        function itemPrice(){
            $('.shop_show_content').each(function(index,item){
                var _this = $(this)
                var $itemcheck = _this.closest('.shop_show_content');
                var price = parseFloat($itemcheck.find('.price').text().slice(0,-1));
                var count = parseFloat( $itemcheck.find('.count').val());
                $itemcheck.find('.item_price').text(price*count)
            })
        }
        
        function alls(_this){
                var all_prices=0;
                var all_counts = 0;
                var itemlength = $('.shop_show_content').find('.itemcheck:checked').length;
                $('.shop_show_content').each(function(){
                    if ($(this).find('.itemcheck').is(':checked')) {
                     var prices= parseFloat($(this).find('.item_price').text());
                     all_prices +=prices 
                    }
                })
                $('.all_price').text(all_prices+'元')
                if(itemlength>0){
                    $('.no_buy').removeClass('nos');
                    is_true=1;
                }else{
                    $('.no_buy').addClass('nos')
                    is_true=0
                }
                
        }

        function remove_check(){
            $('.shop_show_content').each(function(){
                if ($(this).find('.itemcheck').is(':checked')) {
                    $(this).closest('.shop_show_content').remove();
                }
            })
        }

        function change_price(_this,count){
            var price =  parseFloat(_this.closest('.shop_show_content').find('.price').text())
            if(count<=0){
                count=0;
            }
            if(count>goods_count){
                count=goods_count
            }
            _this.closest('.shop_show_content').find('.count').val(count)
            _this.closest('.shop_show_content').find('.item_price').text(count*price)
        }

        $('.itemcheck').on('click',function(){
                var _this = $(this) 
                var alllength = $('.shop_show_content').length;
                var itemlength = $('.shop_show_content').find('.itemcheck:checked').length;
                if(alllength==itemlength){
                    $('.allcheck').attr('checked',true)
                }else{
                    $('.allcheck').attr('checked',false)
                }
                alls(_this)
        })
        $('.allcheck').on('click',function(){
            var _this = $(this)
            if(_this.is(':checked')){
                $('.itemcheck,.allcheck').attr('checked',true)
            }else{
                $('.itemcheck,.allcheck').attr('checked',false)
            }
            alls(_this)
        })
        $('.remove').on('click',function(){
            remove_check()
        })
        $('.qing').on('click',function(){
            $('.shop_show_content').each(function(){
                if ($(this).attr('data-id')==1) {
                    $(this).remove();
                }
            })
        })
        $('.no_buy').on('click',function(){
            if(is_true==1){
                window.location.href='http://www.baidu.com'
            }
        })
        $('.reduce').on('click',function(){
            var count = $(this).closest('.shop_show_content').find('.count').val();
            count--;
            change_price($(this),count)
        })
        $('.add').on('click',function(){
            var count = $(this).closest('.shop_show_content').find('.count').val();
            count++;
            change_price($(this),count)
        })
        $('.close').on('click',function(){
            $(this).closest('.shop_show_content').remove()
        })
    })
    </script>
</body>
</html>